\documentclass[11pt]{article}
\usepackage[utf8]{inputenc}
\usepackage[a4paper, portrait, margin=1.5cm]{geometry}
\usepackage{setspace}
\onehalfspacing
\setlength\parindent{0pt}
\usepackage[table]{xcolor}
\usepackage{tabularx, booktabs, array, calc}
\usepackage{fancyhdr}
\usepackage{hyperref}
\hypersetup{colorlinks,urlcolor=blue}
\renewcommand\familydefault{\sfdefault}

\title{Arbeitszeit {{ data.employee }} -- KW {{ data.week_no }}/{{ data.year }}{{"}"}}
\author{KeinPlan{% if version %} v{{ version }}{% endif %}{{"}"}}

{% macro trunc(text, len) -%}
{{ text|truncate(len, True, "", 0) }}
{%- endmacro -%}

\begin{document}

\section*{Dokumentation der täglichen Arbeitszeit nach {\S}17 MiLoG}

\bigskip

\def\arraystretch{1.3}
\begin{tabular}{ll}
  Dienstgeber: & {\bf {{ data.employer }} } \\
  Mitarbeiter: & {\bf {{ data.employee }} } \\
  Aufzeichnung für: & {\bf KW {{ data.week_no }}/{{ data.year }} }
  {\small ({{ start_date.strftime("%d.%m.%Y") }} -- {{ end_date.strftime("%d.%m.%Y") }})} \\
\end{tabular}

\bigskip
\bigskip

\begin{tabularx}{\textwidth}{llXr}
  {%- for listing in days -%}
    \rowcolor{gray!30}
    \multicolumn{3}{l}{\bf {{ listing.day.strftime("%A, %d.%m.%Y") }} } &
    \bf {{ "%.2f"|format_locale(listing.total_hours) }} h \\
    {%- if listing.entries -%}
      {%- for entry in listing.entries %}
        {{- entry.start_time.strftime("%H:%M") }} -- {{ entry.end_time.strftime("%H:%M") }} &
        {{- trunc(entry.location, 50)|escape_latex }} &
        {{- trunc(entry.title, 50)|escape_latex }} &
        {{- "%.2f"|format_locale(entry.get_hours()) }} h
      {%- endfor -%}
    {%- else -%}
      \multicolumn{4}{p{\textwidth}}{\centering\it\small Keine Dienste.}
    {%- endif -%}
    \vspace{0.3cm} \\  {#- extra space after each day's listing -#}
  {%- endfor -%}
\end{tabularx}

\bigskip

Alle Stundenangaben sind auf jeweils 15 Minuten auf- oder abgerundet.
\hfill
\def\arraystretch{1.0}
\mbox{
  \setlength{\tabcolsep}{10pt}
  \begin{tabular}{rr<{\hspace{-\tabcolsep}} }
    Summe Dienste: & {\bf {{ data.entries|length }} } \\
    Summe Stunden: & {\bf {{ "%.2f"|format_locale(total_hours) }} h} \\
  \end{tabular}
}

\vfill

\textbf{Wichtig:} Die Aufzeichnungen sind wöchentlich zu führen. Dabei sind der Beginn, das Ende und
die Dauer der täglichen Arbeitszeit spätestens bis zum Ablauf des siebten auf den Tag der
Arbeitsleistung folgenden Kalendertages aufzuzeichnen.

\pagestyle{fancy}
\fancyhf{}
\fancyfoot[R]{(\thepage)}
\renewcommand{\headrulewidth}{0pt}
{% if footer %}
  \fancyfoot[L]{\small
    Generiert {{ generation_time.strftime("am %d.%m.%Y um %-H:%M Uhr") }}
    {% if hyperlink %}
      von \href{{ "{" }}{{ hyperlink }}{{ "}" }}{KeinPlan}
      {% if version %} v{{ version }} {% endif %}
    {% endif %}.
  }
{% endif %}

\end{document}
